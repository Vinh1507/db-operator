---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.19.0
  name: clusters.everest.example.com
spec:
  group: everest.example.com
  names:
    kind: Cluster
    listKind: ClusterList
    plural: clusters
    singular: cluster
  scope: Namespaced
  versions:
  - additionalPrinterColumns:
    - jsonPath: .status.phase
      name: Phase
      type: string
    - jsonPath: .status.engines[*].name
      name: Engines
      type: integer
    - jsonPath: .metadata.creationTimestamp
      name: Age
      type: date
    name: v1alpha1
    schema:
      openAPIV3Schema:
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: ClusterSpec defines the desired state
            properties:
              engines:
                items:
                  properties:
                    backup:
                      properties:
                        backupStorageName:
                          type: string
                        backupStorages:
                          items:
                            description: BackupStorage references and configures a
                              backup storage location
                            properties:
                              name:
                                description: Name of the backup storage (reference
                                  to BackupStorage CR or logical name)
                                type: string
                              secretRef:
                                description: secret ref
                                type: string
                            required:
                            - name
                            type: object
                          type: array
                        enabled:
                          type: boolean
                        schedules:
                          items:
                            properties:
                              backupStorageName:
                                type: string
                              backupType:
                                type: string
                              enabled:
                                type: boolean
                              name:
                                type: string
                              retentionCopies:
                                format: int32
                                type: integer
                              schedule:
                                type: string
                            required:
                            - enabled
                            - name
                            - schedule
                            type: object
                          type: array
                      required:
                      - enabled
                      type: object
                    config:
                      properties:
                        kv:
                          additionalProperties:
                            type: string
                          type: object
                        raw:
                          type: string
                      type: object
                    credentialsSecretNames:
                      items:
                        type: string
                      type: array
                    expose:
                      properties:
                        enabled:
                          type: boolean
                        port:
                          format: int32
                          type: integer
                        type:
                          type: string
                      required:
                      - enabled
                      type: object
                    monitoring:
                      properties:
                        enabled:
                          type: boolean
                        exporterPort:
                          format: int32
                          type: integer
                        monitoringConfigName:
                          type: string
                      required:
                      - enabled
                      type: object
                    name:
                      type: string
                    priority:
                      format: int32
                      type: integer
                    replicas:
                      format: int32
                      type: integer
                    resources:
                      properties:
                        cpu:
                          type: string
                        memory:
                          type: string
                      required:
                      - cpu
                      - memory
                      type: object
                    storage:
                      properties:
                        class:
                          type: string
                        enabled:
                          type: boolean
                        size:
                          type: string
                      required:
                      - enabled
                      type: object
                    type:
                      type: string
                    version:
                      type: string
                  required:
                  - name
                  - priority
                  - replicas
                  - type
                  - version
                  type: object
                type: array
              paused:
                type: boolean
              providerType:
                type: string
            required:
            - engines
            - providerType
            type: object
          status:
            description: ClusterStatus defines the observed state
            properties:
              conditions:
                description: Conditions represent the latest available observations
                  of the cluster's state
                items:
                  description: Condition contains details for one aspect of the current
                    state of this API Resource.
                  properties:
                    lastTransitionTime:
                      description: |-
                        lastTransitionTime is the last time the condition transitioned from one status to another.
                        This should be when the underlying condition changed.  If that is not known, then using the time when the API field changed is acceptable.
                      format: date-time
                      type: string
                    message:
                      description: |-
                        message is a human readable message indicating details about the transition.
                        This may be an empty string.
                      maxLength: 32768
                      type: string
                    observedGeneration:
                      description: |-
                        observedGeneration represents the .metadata.generation that the condition was set based upon.
                        For instance, if .metadata.generation is currently 12, but the .status.conditions[x].observedGeneration is 9, the condition is out of date
                        with respect to the current state of the instance.
                      format: int64
                      minimum: 0
                      type: integer
                    reason:
                      description: |-
                        reason contains a programmatic identifier indicating the reason for the condition's last transition.
                        Producers of specific condition types may define expected values and meanings for this field,
                        and whether the values are considered a guaranteed API.
                        The value should be a CamelCase string.
                        This field may not be empty.
                      maxLength: 1024
                      minLength: 1
                      pattern: ^[A-Za-z]([A-Za-z0-9_,:]*[A-Za-z0-9_])?$
                      type: string
                    status:
                      description: status of the condition, one of True, False, Unknown.
                      enum:
                      - "True"
                      - "False"
                      - Unknown
                      type: string
                    type:
                      description: type of condition in CamelCase or in foo.example.com/CamelCase.
                      maxLength: 316
                      pattern: ^([a-z0-9]([-a-z0-9]*[a-z0-9])?(\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*/)?(([A-Za-z0-9][-A-Za-z0-9_.]*)?[A-Za-z0-9])$
                      type: string
                  required:
                  - lastTransitionTime
                  - message
                  - reason
                  - status
                  - type
                  type: object
                type: array
              endpoints:
                description: Connection endpoints for client
                items:
                  properties:
                    endpoint:
                      description: Endpoint address (host:port or URL)
                      type: string
                    name:
                      description: Logical name of endpoint (e.g. primary, replica,
                        read, write)
                      type: string
                  required:
                  - endpoint
                  - name
                  type: object
                type: array
              engines:
                description: Engines contains status for each engine in the cluster
                items:
                  description: EngineStatus represents the status of a single engine
                  properties:
                    conditions:
                      description: Conditions represent the latest available observations
                      items:
                        description: Condition contains details for one aspect of
                          the current state of this API Resource.
                        properties:
                          lastTransitionTime:
                            description: |-
                              lastTransitionTime is the last time the condition transitioned from one status to another.
                              This should be when the underlying condition changed.  If that is not known, then using the time when the API field changed is acceptable.
                            format: date-time
                            type: string
                          message:
                            description: |-
                              message is a human readable message indicating details about the transition.
                              This may be an empty string.
                            maxLength: 32768
                            type: string
                          observedGeneration:
                            description: |-
                              observedGeneration represents the .metadata.generation that the condition was set based upon.
                              For instance, if .metadata.generation is currently 12, but the .status.conditions[x].observedGeneration is 9, the condition is out of date
                              with respect to the current state of the instance.
                            format: int64
                            minimum: 0
                            type: integer
                          reason:
                            description: |-
                              reason contains a programmatic identifier indicating the reason for the condition's last transition.
                              Producers of specific condition types may define expected values and meanings for this field,
                              and whether the values are considered a guaranteed API.
                              The value should be a CamelCase string.
                              This field may not be empty.
                            maxLength: 1024
                            minLength: 1
                            pattern: ^[A-Za-z]([A-Za-z0-9_,:]*[A-Za-z0-9_])?$
                            type: string
                          status:
                            description: status of the condition, one of True, False,
                              Unknown.
                            enum:
                            - "True"
                            - "False"
                            - Unknown
                            type: string
                          type:
                            description: type of condition in CamelCase or in foo.example.com/CamelCase.
                            maxLength: 316
                            pattern: ^([a-z0-9]([-a-z0-9]*[a-z0-9])?(\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*/)?(([A-Za-z0-9][-A-Za-z0-9_.]*)?[A-Za-z0-9])$
                            type: string
                        required:
                        - lastTransitionTime
                        - message
                        - reason
                        - status
                        - type
                        type: object
                      type: array
                    credentialsSecrets:
                      description: Credential
                      items:
                        properties:
                          name:
                            description: Name hiển thị / logical name
                            type: string
                          refName:
                            description: RefName là tên Secret thực tế trong k8s
                            type: string
                          refNamespace:
                            description: RefNamespace là namespace của Secret
                            type: string
                        required:
                        - name
                        - refName
                        type: object
                      type: array
                    endpoints:
                      description: Connection endpoints for client
                      items:
                        properties:
                          endpoint:
                            description: Endpoint address (host:port or URL)
                            type: string
                          name:
                            description: Logical name of endpoint (e.g. primary, replica,
                              read, write)
                            type: string
                        required:
                        - endpoint
                        - name
                        type: object
                      type: array
                    lastUpdateTime:
                      description: Last time this status was updated
                      format: date-time
                      type: string
                    message:
                      description: Human-readable message about current state
                      type: string
                    name:
                      description: Name of the engine (matches EngineSpec.Name)
                      type: string
                    phase:
                      description: Phase of the engine (Ready, Initializing, Failed,
                        etc.)
                      type: string
                    ready:
                      description: Number of ready instances
                      format: int32
                      type: integer
                    total:
                      description: Total number of desired instances
                      format: int32
                      type: integer
                    type:
                      description: Type of the engine (cnpg, pxc, proxysql, etc.)
                      type: string
                    version:
                      description: Current version running
                      type: string
                  required:
                  - name
                  - phase
                  - ready
                  - total
                  - type
                  type: object
                type: array
              lastUpdateTime:
                description: LastUpdateTime is the last time the status was updated
                format: date-time
                type: string
              message:
                description: Message provides human-readable information
                type: string
              observedGeneration:
                description: ObservedGeneration reflects the generation of the most
                  recently observed Cluster
                format: int64
                type: integer
              phase:
                description: Phase represents the overall cluster state
                enum:
                - Initializing
                - Ready
                - Upgrading
                - Failed
                - Deleting
                - Paused
                type: string
              reason:
                description: Reason provides more context about the current phase
                type: string
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
